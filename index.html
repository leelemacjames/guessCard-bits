<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entropy & Card Combinatorics - Information Theory</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        section {
            margin-bottom: 50px;
        }

        h2 {
            color: #2a5298;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        h3 {
            color: #667eea;
            font-size: 1.5em;
            margin: 25px 0 15px 0;
        }

        .concept-box {
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .info-theory-box {
            background: #e8eaf6;
            border: 2px solid #5c6bc0;
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
        }

        .formula {
            background: #fff;
            border: 2px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            text-align: center;
            font-size: 1.1em;
        }

        .interactive-demo {
            background: #e3f2fd;
            padding: 30px;
            border-radius: 10px;
            margin: 30px 0;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
        }

        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 8px;
            margin: 20px 0;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
        }

        .playing-card {
            width: 70px;
            height: 98px;
            border: 2px solid #333;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            font-size: 1.3em;
            font-weight: bold;
            transition: all 0.4s ease;
            position: relative;
            cursor: pointer;
        }

        .playing-card.hidden {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: transparent;
            border-color: #667eea;
        }

        .playing-card.eliminated {
            opacity: 1;
            background: white;
            border-color: #ddd;
            animation: reveal 0.5s ease;
        }

        .playing-card.secret {
            border: 3px solid #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            animation: pulse 1.5s infinite;
        }

        @keyframes reveal {
            0% { transform: rotateY(90deg); opacity: 0; }
            100% { transform: rotateY(0); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.6); }
            50% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.9); }
        }

        .red-suit {
            color: #e53935;
        }

        .black-suit {
            color: #212121;
        }

        .question-builder {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #667eea;
        }

        .query-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .query-row label {
            font-weight: bold;
            color: #667eea;
            min-width: 100px;
        }

        select {
            padding: 10px 15px;
            font-size: 1em;
            border: 2px solid #667eea;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            min-width: 150px;
        }

        select:hover {
            border-color: #764ba2;
        }

        .ask-button {
            background: #4caf50;
            padding: 12px 40px;
            font-size: 1.1em;
            font-weight: bold;
        }

        .ask-button:hover {
            background: #388e3c;
        }

        .question-log {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
        }

        .question-log.no-answer {
            border-left-color: #f44336;
        }

        .info-bits {
            font-size: 1.1em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .calculation-detail {
            background: #fff9c4;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #fbc02d;
            font-family: 'Courier New', monospace;
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        #output {
            margin-top: 20px;
        }

        .highlight {
            background: #fff59d;
            padding: 2px 5px;
            border-radius: 3px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background: #667eea;
            color: white;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        .poker-hand {
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
        }

        .step {
            background: white;
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
        }

        .calculation {
            font-family: 'Courier New', monospace;
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .strategy-card {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .strategy-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .question-section {
            background: #fff3e0;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #ff9800;
        }

        .answer-section {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #4caf50;
        }

        .query-preview {
            background: #e8eaf6;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 1.2em;
            font-weight: bold;
            color: #1e3c72;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé¥ Entropy Through Card Combinatorics</h1>
            <p class="subtitle">Understanding Information Theory via Sequential Question Elimination</p>
        </header>

        <div class="content">
            <!-- Information Theory Primer -->
            <section>
                <h2>üìä Information Theory Fundamentals</h2>
                
                <div class="info-theory-box">
                    <h3>What is a "Bit" of Information?</h3>
                    <p>A <strong>bit</strong> (binary digit) is the fundamental unit of information. It represents the answer to a single yes/no question.</p>
                    
                    <div class="formula">
                        Information (in bits) = log‚ÇÇ(Number of possibilities before / Number of possibilities after)
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <strong>Key Examples:</strong>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Perfect split (50/50):</strong> log‚ÇÇ(52/26) = log‚ÇÇ(2) = <span class="highlight">1 bit</span></li>
                            <li><strong>One specific card:</strong> log‚ÇÇ(52/1) = <span class="highlight">5.7 bits</span> (need ~6 questions)</li>
                            <li><strong>Asymmetric split (52‚Üí40):</strong> log‚ÇÇ(52/40) = log‚ÇÇ(1.3) = <span class="highlight">0.38 bits</span></li>
                        </ul>
                    </div>
                </div>

                <div class="concept-box">
                    <h3>Optimal vs Sub-Optimal Questioning Strategy</h3>
                    <p><strong>Optimal Strategy:</strong> Each question should eliminate approximately <em>half</em> of the remaining possibilities, yielding 1 bit of information per question.</p>
                    <p style="margin-top: 10px;"><strong>Sub-Optimal Strategy:</strong> Questions that create uneven splits (like "Is it the Ace of Spades?") provide much less information and require many more questions.</p>
                </div>
            </section>

            <!-- Interactive Card Guessing Game -->
            <section>
                <h2>üéØ Interactive: Guess the Card with Custom Questions</h2>
                
                <div class="interactive-demo">
                    <h3>The Challenge</h3>
                    <p>I've selected one card from the 52-card deck below. Build custom yes/no questions using the dropdown menus to identify it. Watch as eliminated cards are revealed with each answer!</p>
                    
                    <button onclick="startGame()" style="font-size: 1.2em; padding: 15px 40px;">üé¥ Start New Game</button>
                    
                    <div id="gameArea" style="display:none;">
                        <div class="stats-panel" id="statsPanel">
                            <div class="stat-card">
                                <div class="stat-label">Questions Asked</div>
                                <div class="stat-value" id="questionCount">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Cards Remaining</div>
                                <div class="stat-value" id="cardsRemaining">52</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Total Information</div>
                                <div class="stat-value" id="totalBits">0.00 bits</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Theoretical Minimum</div>
                                <div class="stat-value">5.70 bits</div>
                            </div>
                        </div>

                        <h3>All 52 Cards:</h3>
                        <div class="card-grid" id="cardGrid"></div>
                        
                        <h3>Build Your Question:</h3>
                        <div class="question-builder">
                            <div class="query-row">
                                <label>Ask about:</label>
                                <select id="questionType" onchange="updateQuestionBuilder()">
                                    <option value="">-- Select Category --</option>
                                    <option value="color">Color (Red/Black)</option>
                                    <option value="suit">Suit (‚ô†‚ô•‚ô¶‚ô£)</option>
                                    <option value="face">Face Card (J/Q/K)</option>
                                    <option value="rank">Specific Rank</option>
                                    <option value="comparison">Value Comparison</option>
                                </select>
                            </div>

                            <!-- Color Question -->
                            <div id="colorQuestion" class="query-row" style="display:none;">
                                <label>Is it:</label>
                                <select id="colorValue">
                                    <option value="red">Red</option>
                                    <option value="black">Black</option>
                                </select>
                            </div>

                            <!-- Suit Question -->
                            <div id="suitQuestion" class="query-row" style="display:none;">
                                <label>Is it a:</label>
                                <select id="suitValue">
                                    <option value="‚ô†">Spade ‚ô†</option>
                                    <option value="‚ô•">Heart ‚ô•</option>
                                    <option value="‚ô¶">Diamond ‚ô¶</option>
                                    <option value="‚ô£">Club ‚ô£</option>
                                </select>
                            </div>

                            <!-- Face Card Question -->
                            <div id="faceQuestion" class="query-row" style="display:none;">
                                <label>Is it:</label>
                                <select id="faceValue">
                                    <option value="yes">A face card (J/Q/K)</option>
                                    <option value="no">Not a face card</option>
                                </select>
                            </div>

                            <!-- Rank Question -->
                            <div id="rankQuestion" class="query-row" style="display:none;">
                                <label>Is it a:</label>
                                <select id="rankValue">
                                    <option value="A">Ace</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="J">Jack</option>
                                    <option value="Q">Queen</option>
                                    <option value="K">King</option>
                                </select>
                            </div>

                            <!-- Comparison Question -->
                            <div id="comparisonQuestion" class="query-row" style="display:none;">
                                <label>Is the value:</label>
                                <select id="comparisonOperator">
                                    <option value="above">Above (>)</option>
                                    <option value="below">Below (<)</option>
                                    <option value="atLeast">At least (‚â•)</option>
                                    <option value="atMost">At most (‚â§)</option>
                                </select>
                                <select id="comparisonValue">
                                    <option value="1">Ace (1)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">Jack (11)</option>
                                    <option value="12">Queen (12)</option>
                                    <option value="13">King (13)</option>
                                </select>
                            </div>

                            <div id="questionPreview" class="query-preview" style="display:none;">
                                Question: <span id="previewText"></span>
                            </div>

                            <div style="text-align: center; margin-top: 20px;">
                                <button id="askButton" class="ask-button" onclick="askCustomQuestion()" disabled>
                                    ‚ùì Ask This Question
                                </button>
                                <button onclick="revealCard()" style="background: #ffd700; color: #333;">
                                    üîç Reveal Secret Card
                                </button>
                            </div>
                        </div>
                        
                        <div id="output"></div>
                    </div>
                </div>
            </section>

            <!-- Poker Hands Section -->
            <section>
                <h2>üÉè Poker Hands: Macrostates & Microstates</h2>
                
                <div class="concept-box">
                    <h3>Understanding Macrostates vs Microstates</h3>
                    <p><strong>Macrostate:</strong> A general description of a system (e.g., "full house" - three of one rank, two of another)</p>
                    <p><strong>Microstate:</strong> A specific configuration (e.g., 9‚ô• 9‚ô¶ 9‚ô£ 2‚ô† 2‚ô£)</p>
                    <p style="margin-top: 15px;"><em>The entropy of a macrostate is proportional to the logarithm of the number of microstates it contains.</em></p>
                </div>

                <!-- Full House Example -->
                <div class="poker-hand">
                    <h3>üìò Detailed Example: Full House</h3>
                    
                    <div class="question-section">
                        <strong>Macrostate Definition:</strong> "A 5-card hand with three cards of one rank and two cards of another rank"
                        <p style="margin-top: 10px;">Examples: 9‚ô•9‚ô¶9‚ô£2‚ô†2‚ô£ or K‚ô†K‚ô•K‚ô¶A‚ô•A‚ô£</p>
                    </div>

                    <div class="step">
                        <strong>Step 1:</strong> Choose which rank appears three times
                        <div class="calculation">
                            We have 13 ranks (A, 2, 3, ..., K)<br>
                            Choose 1 for the triplet: C(13, 1) = 13 ways
                        </div>
                    </div>

                    <div class="step">
                        <strong>Step 2:</strong> Choose which 3 suits (out of 4) for that rank
                        <div class="calculation">
                            For any rank, we have 4 suits available<br>
                            Choose 3 suits: C(4, 3) = 4 ways<br>
                            <span style="color: #666;">(‚ô†‚ô•‚ô¶, ‚ô†‚ô•‚ô£, ‚ô†‚ô¶‚ô£, or ‚ô•‚ô¶‚ô£)</span>
                        </div>
                    </div>

                    <div class="step">
                        <strong>Step 3:</strong> Choose which rank appears twice (must be different from Step 1)
                        <div class="calculation">
                            We have 12 remaining ranks<br>
                            Choose 1 for the pair: C(12, 1) = 12 ways
                        </div>
                    </div>

                    <div class="step">
                        <strong>Step 4:</strong> Choose which 2 suits (out of 4) for the pair
                        <div class="calculation">
                            For that rank, we have 4 suits<br>
                            Choose 2 suits: C(4, 2) = 6 ways<br>
                            <span style="color: #666;">(‚ô†‚ô•, ‚ô†‚ô¶, ‚ô†‚ô£, ‚ô•‚ô¶, ‚ô•‚ô£, or ‚ô¶‚ô£)</span>
                        </div>
                    </div>

                    <div class="answer-section">
                        <strong>Total Microstates for Full House:</strong>
                        <div class="calculation" style="font-size: 1.3em; margin: 20px 0; background: white;">
                            13 √ó 4 √ó 12 √ó 6 = <span class="highlight" style="font-size: 1.2em;">3,744 distinct hands</span>
                        </div>
                        <div class="calculation">
                            Total possible 5-card hands = C(52, 5) = 2,598,960
                        </div>
                        <div class="calculation" style="margin-top: 10px;">
                            Probability = 3,744 / 2,598,960 = 0.001441 ‚âà <strong>0.144% or 1 in 694</strong>
                        </div>
                        <div class="calculation" style="margin-top: 15px; background: #e3f2fd;">
                            <strong>Shannon Entropy:</strong> H = log‚ÇÇ(3,744) ‚âà <span class="highlight">11.87 bits</span><br>
                            <span style="font-size: 0.9em; color: #666;">(This is the information needed to specify which full house)</span>
                        </div>
                    </div>
                </div>

                <!-- Four of a Kind Example -->
                <div class="poker-hand">
                    <h3>üìó Detailed Example: Four of a Kind</h3>
                    
                    <div class="step">
                        <strong>Step 1:</strong> Choose which rank appears four times
                        <div class="calculation">C(13, 1) = 13 ways</div>
                    </div>

                    <div class="step">
                        <strong>Step 2:</strong> Take all 4 suits for that rank
                        <div class="calculation">
                            C(4, 4) = 1 way<br>
                            <span style="color: #666;">(Must be ‚ô†‚ô•‚ô¶‚ô£ - all four suits)</span>
                        </div>
                    </div>

                    <div class="step">
                        <strong>Step 3:</strong> Choose rank for the "kicker" (5th card)
                        <div class="calculation">
                            12 remaining ranks<br>
                            C(12, 1) = 12 ways
                        </div>
                    </div>

                    <div class="step">
                        <strong>Step 4:</strong> Choose suit for the kicker
                        <div class="calculation">C(4, 1) = 4 ways</div>
                    </div>

                    <div class="answer-section">
                        <strong>Total Microstates for Four of a Kind:</strong>
                        <div class="calculation" style="font-size: 1.3em; margin: 20px 0; background: white;">
                            13 √ó 1 √ó 12 √ó 4 = <span class="highlight" style="font-size: 1.2em;">624 distinct hands</span>
                        </div>
                        <div class="calculation">
                            Probability = 624 / 2,598,960 = 0.000240 ‚âà <strong>0.024% or 1 in 4,165</strong>
                        </div>
                        <div class="calculation" style="margin-top: 15px; background: #e3f2fd;">
                            <strong>Shannon Entropy:</strong> H = log‚ÇÇ(624) ‚âà <span class="highlight">9.29 bits</span><br>
                            <span style="font-size: 0.9em; color: #666;">(Lower entropy = rarer hand)</span>
                        </div>
                    </div>
                </div>

                <!-- Complete Rankings -->
                <h3>üìä Complete Poker Hand Rankings</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Hand Type (Macrostate)</th>
                            <th>Microstates (Œ©)</th>
                            <th>Probability</th>
                            <th>Odds</th>
                            <th>Entropy (bits)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Royal Flush</strong></td>
                            <td>4</td>
                            <td>0.000154%</td>
                            <td>1 in 649,740</td>
                            <td>2.00</td>
                        </tr>
                        <tr>
                            <td><strong>Straight Flush</strong></td>
                            <td>36</td>
                            <td>0.00139%</td>
                            <td>1 in 72,193</td>
                            <td>5.17</td>
                        </tr>
                        <tr>
                            <td><strong>Four of a Kind</strong></td>
                            <td>624</td>
                            <td>0.0240%</td>
                            <td>1 in 4,165</td>
                            <td>9.29</td>
                        </tr>
                        <tr>
                            <td><strong>Full House</strong></td>
                            <td>3,744</td>
                            <td>0.1441%</td>
                            <td>1 in 694</td>
                            <td>11.87</td>
                        </tr>
                        <tr>
                            <td><strong>Flush</strong></td>
                            <td>5,108</td>
                            <td>0.1965%</td>
                            <td>1 in 508</td>
                            <td>12.32</td>
                        </tr>
                        <tr>
                            <td><strong>Straight</strong></td>
                            <td>10,200</td>
                            <td>0.3925%</td>
                            <td>1 in 255</td>
                            <td>13.32</td>
                        </tr>
                        <tr>
                            <td><strong>Three of a Kind</strong></td>
                            <td>54,912</td>
                            <td>2.1128%</td>
                            <td>1 in 47</td>
                            <td>15.75</td>
                        </tr>
                        <tr>
                            <td><strong>Two Pair</strong></td>
                            <td>123,552</td>
                            <td>4.7539%</td>
                            <td>1 in 21</td>
                            <td>16.92</td>
                        </tr>
                        <tr>
                            <td><strong>One Pair</strong></td>
                            <td>1,098,240</td>
                            <td>42.2569%</td>
                            <td>1 in 2.37</td>
                            <td>20.06</td>
                        </tr>
                        <tr>
                            <td><strong>High Card</strong></td>
                            <td>1,302,540</td>
                            <td>50.1177%</td>
                            <td>1 in 1.99</td>
                            <td>20.32</td>
                        </tr>
                    </tbody>
                </table>

                <div class="concept-box">
                    <h3>üî¨ The Entropy Connection</h3>
                    <p><strong>Boltzmann's Formula:</strong> S = k<sub>B</sub> ln(Œ©)</p>
                    <p><strong>Shannon's Formula:</strong> H = log‚ÇÇ(Œ©)</p>
                    <p style="margin-top: 15px;">Both formulas show that <span class="highlight">entropy increases with the number of microstates</span>. In poker:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>Low entropy (rare):</strong> Royal Flush (2.00 bits, 4 microstates)</li>
                        <li><strong>High entropy (common):</strong> High Card (20.32 bits, 1,302,540 microstates)</li>
                    </ul>
                    <p style="margin-top: 15px;"><em>This parallels thermodynamics: systems naturally evolve toward states with more microstates (higher entropy)!</em></p>
                </div>
            </section>
        </div>
    </div>

    <script>
        let fullDeck = [];
        let secretCard = null;
        let remainingCards = [];
        let eliminatedCards = [];
        let questionCount = 0;
        let totalBits = 0;

        const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
        const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

        function createFullDeck() {
            const deck = [];
            for (let suit of suits) {
                for (let rank of ranks) {
                    deck.push({
                        rank: rank,
                        suit: suit,
                        color: (suit === '‚ô•' || suit === '‚ô¶') ? 'red' : 'black',
                        isFace: ['J', 'Q', 'K'].includes(rank),
                        value: rank === 'A' ? 1 : ['J', 'Q', 'K'].includes(rank) ? 11 + ['J', 'Q', 'K'].indexOf(rank) : parseInt(rank),
                        id: rank + suit
                    });
                }
            }
            return deck;
        }

        function startGame() {
            fullDeck = createFullDeck();
            secretCard = fullDeck[Math.floor(Math.random() * fullDeck.length)];
            remainingCards = [...fullDeck];
            eliminatedCards = [];
            questionCount = 0;
            totalBits = 0;
            
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('output').innerHTML = '<div class="question-log"><p style="color: #667eea; font-weight: bold; font-size: 1.2em;">üéÆ Game Started! I\'ve secretly selected one card. Build custom questions using the dropdown menus to identify it!</p></div>';
            
            // Reset question builder
            document.getElementById('questionType').value = '';
            updateQuestionBuilder();
            
            updateStats();
            displayAllCards();
        }

        function displayAllCards() {
            const grid = document.getElementById('cardGrid');
            grid.innerHTML = '';
            
            for (let card of fullDeck) {
                const cardDiv = document.createElement('div');
                const isEliminated = eliminatedCards.some(c => c.id === card.id);
                const isSecret = secretCard && card.id === secretCard.id;
                
                cardDiv.className = 'playing-card';
                
                if (isSecret && eliminatedCards.length === 51) {
                    // Reveal secret card
                    cardDiv.className += ' secret ' + (card.color === 'red' ? 'red-suit' : 'black-suit');
                    cardDiv.innerHTML = `<div style="font-size: 1.5em;">${card.rank}</div><div style="font-size: 1.3em;">${card.suit}</div>`;
                } else if (isEliminated) {
                    cardDiv.className += ' eliminated ' + (card.color === 'red' ? 'red-suit' : 'black-suit');
                    cardDiv.innerHTML = `<div style="font-size: 1.2em;">${card.rank}</div><div>${card.suit}</div>`;
                } else {
                    cardDiv.className += ' hidden';
                    cardDiv.innerHTML = '<div style="font-size: 2em;">üÇ†</div>';
                }
                
                grid.appendChild(cardDiv);
            }
        }

        function updateStats() {
            document.getElementById('questionCount').textContent = questionCount;
            document.getElementById('cardsRemaining').textContent = remainingCards.length;
            document.getElementById('totalBits').textContent = totalBits.toFixed(2) + ' bits';
        }

        function updateQuestionBuilder() {
            const questionType = document.getElementById('questionType').value;
            
            // Hide all question options
            document.getElementById('colorQuestion').style.display = 'none';
            document.getElementById('suitQuestion').style.display = 'none';
            document.getElementById('faceQuestion').style.display = 'none';
            document.getElementById('rankQuestion').style.display = 'none';
            document.getElementById('comparisonQuestion').style.display = 'none';
            document.getElementById('questionPreview').style.display = 'none';
            document.getElementById('askButton').disabled = true;
            
            // Show relevant question option
            if (questionType === 'color') {
                document.getElementById('colorQuestion').style.display = 'flex';
                updatePreview();
            } else if (questionType === 'suit') {
                document.getElementById('suitQuestion').style.display = 'flex';
                updatePreview();
            } else if (questionType === 'face') {
                document.getElementById('faceQuestion').style.display = 'flex';
                updatePreview();
            } else if (questionType === 'rank') {
                document.getElementById('rankQuestion').style.display = 'flex';
                updatePreview();
            } else if (questionType === 'comparison') {
                document.getElementById('comparisonQuestion').style.display = 'flex';
                updatePreview();
            }
        }

        function updatePreview() {
            const questionType = document.getElementById('questionType').value;
            let previewText = '';
            
            if (questionType === 'color') {
                const color = document.getElementById('colorValue').value;
                previewText = `Is it ${color}?`;
            } else if (questionType === 'suit') {
                const suit = document.getElementById('suitValue').value;
                const suitName = {'‚ô†': 'spade', '‚ô•': 'heart', '‚ô¶': 'diamond', '‚ô£': 'club'}[suit];
                previewText = `Is it a ${suitName} ${suit}?`;
            } else if (questionType === 'face') {
                const faceValue = document.getElementById('faceValue').value;
                previewText = faceValue === 'yes' ? 'Is it a face card (J/Q/K)?' : 'Is it NOT a face card?';
            } else if (questionType === 'rank') {
                const rank = document.getElementById('rankValue').value;
                previewText = `Is it a ${rank}?`;
            } else if (questionType === 'comparison') {
                const operator = document.getElementById('comparisonOperator').value;
                const value = document.getElementById('comparisonValue').value;
                const operatorText = {
                    'above': 'above',
                    'below': 'below',
                    'atLeast': 'at least',
                    'atMost': 'at most'
                }[operator];
                previewText = `Is the value ${operatorText} ${value}?`;
            }
            
            if (previewText) {
                document.getElementById('previewText').textContent = previewText;
                document.getElementById('questionPreview').style.display = 'block';
                document.getElementById('askButton').disabled = false;
            }
        }

        // Add event listeners to update preview when selections change
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('colorValue').addEventListener('change', updatePreview);
            document.getElementById('suitValue').addEventListener('change', updatePreview);
            document.getElementById('faceValue').addEventListener('change', updatePreview);
            document.getElementById('rankValue').addEventListener('change', updatePreview);
            document.getElementById('comparisonOperator').addEventListener('change', updatePreview);
            document.getElementById('comparisonValue').addEventListener('change', updatePreview);
        });

        function askCustomQuestion() {
    if (!secretCard) {
        alert('Please start a game first!');
        return;
    }
    
    if (remainingCards.length === 1) {
        alert('Only one card remains! Reveal it to see if you found the secret card.');
        return;
    }
    
    const questionType = document.getElementById('questionType').value;
    let answer = false;
    let newEliminated = [];
    let questionText = document.getElementById('previewText').textContent;
    
    questionCount++;
    const beforeCount = remainingCards.length;
    
    // Determine answer and eliminate cards based on question type
    if (questionType === 'color') {
        const color = document.getElementById('colorValue').value;
        answer = secretCard.color === color;
        // If answer is YES, keep cards with this color (eliminate opposite color)
        // If answer is NO, keep cards with opposite color (eliminate this color)
        newEliminated = remainingCards.filter(c => answer ? c.color !== color : c.color === color);
        
    } else if (questionType === 'suit') {
        const suit = document.getElementById('suitValue').value;
        answer = secretCard.suit === suit;
        // If YES, eliminate non-suit cards; if NO, eliminate suit cards
        newEliminated = remainingCards.filter(c => answer ? c.suit !== suit : c.suit === suit);
        
    } else if (questionType === 'face') {
        const faceValue = document.getElementById('faceValue').value;
        const isFaceCard = (faceValue === 'yes');
        answer = secretCard.isFace === isFaceCard;
        // If YES, eliminate non-face cards; if NO, eliminate face cards
        newEliminated = remainingCards.filter(c => answer ? c.isFace !== isFaceCard : c.isFace === isFaceCard);
        
    } else if (questionType === 'rank') {
        const rank = document.getElementById('rankValue').value;
        answer = secretCard.rank === rank;
        // If YES, eliminate cards that aren't this rank; if NO, eliminate cards that are this rank
        newEliminated = remainingCards.filter(c => answer ? c.rank !== rank : c.rank === rank);
        
    } else if (questionType === 'comparison') {
        const operator = document.getElementById('comparisonOperator').value;
        const value = parseInt(document.getElementById('comparisonValue').value);
        
        if (operator === 'above') {
            answer = secretCard.value > value;
            // If YES (card is above value), eliminate cards <= value
            // If NO (card is not above value), eliminate cards > value
            newEliminated = remainingCards.filter(c => answer ? c.value <= value : c.value > value);
            
        } else if (operator === 'below') {
            answer = secretCard.value < value;
            // If YES (card is below value), eliminate cards >= value
            // If NO (card is not below value), eliminate cards < value
            newEliminated = remainingCards.filter(c => answer ? c.value >= value : c.value < value);
            
        } else if (operator === 'atLeast') {
            answer = secretCard.value >= value;
            // If YES (card is at least value), eliminate cards < value
            // If NO (card is less than value), eliminate cards >= value
            newEliminated = remainingCards.filter(c => answer ? c.value < value : c.value >= value);
            
        } else if (operator === 'atMost') {
            answer = secretCard.value <= value;
            // If YES (card is at most value), eliminate cards > value
            // If NO (card is greater than value), eliminate cards <= value
            newEliminated = remainingCards.filter(c => answer ? c.value > value : c.value <= value);
        }
    }
    
    // Update remaining and eliminated cards
    eliminatedCards = [...eliminatedCards, ...newEliminated];
    remainingCards = remainingCards.filter(c => !newEliminated.some(e => e.id === c.id));
    
    const afterCount = remainingCards.length;
    const bitsGained = afterCount > 0 ? Math.log2(beforeCount / afterCount) : Math.log2(beforeCount);
    totalBits += bitsGained;
    
    // Create detailed calculation display
    const calcDetail = `
        <div class="calculation-detail">
            <strong>üìê Detailed Calculation:</strong><br><br>
            <strong>Before this question:</strong> ${beforeCount} cards remaining<br>
            <strong>After this answer:</strong> ${afterCount} cards remaining<br>
            <strong>Cards eliminated:</strong> ${newEliminated.length} cards<br><br>
            <strong>Information Gained:</strong><br>
            I = log‚ÇÇ(N_before / N_after)<br>
            I = log‚ÇÇ(${beforeCount} / ${afterCount})<br>
            I = log‚ÇÇ(${(beforeCount/afterCount).toFixed(3)})<br>
            I = <span class="highlight">${bitsGained.toFixed(3)} bits</span><br><br>
            <em>${bitsGained >= 0.95 ? '‚úÖ Excellent! Nearly optimal 1-bit question' : 
                 bitsGained >= 0.7 ? 'üëç Good question with decent information' :
                 bitsGained >= 0.4 ? '‚ö†Ô∏è Moderate - consider more balanced questions' :
                 '‚ùå Sub-optimal - this question eliminated very few cards'}</em>
        </div>
    `;
    
    const logClass = answer ? 'question-log' : 'question-log no-answer';
    document.getElementById('output').innerHTML += `
        <div class="${logClass}">
            <strong style="font-size: 1.1em;">Q${questionCount}: ${questionText}</strong><br>
            <div style="margin: 10px 0; padding: 10px; background: ${answer ? '#c8e6c9' : '#ffcdd2'}; border-radius: 5px;">
                <strong>Answer: ${answer ? '‚úÖ YES' : '‚ùå NO'}</strong>
            </div>
            ${calcDetail}
            <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 5px;">
                <strong>üìä Current State:</strong><br>
                Remaining possibilities: <strong>${afterCount}</strong> cards<br>
                Cumulative information: <strong>${totalBits.toFixed(2)}</strong> bits<br>
                Information still needed: <strong>${afterCount > 0 ? (Math.log2(afterCount)).toFixed(2) : '0.00'}</strong> bits<br>
                Theoretical questions remaining: <strong>${afterCount > 0 ? Math.ceil(Math.log2(afterCount)) : 0}</strong> questions
            </div>
        </div>
    `;
    
    updateStats();
    displayAllCards();
    
    // Check win condition
    if (remainingCards.length === 1) {
        setTimeout(() => {
            document.getElementById('output').innerHTML += `
                <div class="question-log" style="background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); border-left: 5px solid #f9a825;">
                    <h3 style="color: #333;">üéâ Only ONE card remains!</h3>
                    <p style="font-size: 1.1em;">Click "Reveal Secret Card" to see if you found it!</p>
                </div>
            `;
        }, 500);
    }
}

        function revealCard() {
            if (!secretCard) {
                alert('Please start a game first!');
                return;
            }
            
            eliminatedCards = fullDeck.filter(c => c.id !== secretCard.id);
            remainingCards = [secretCard];
            
            displayAllCards();
            
            const efficiency = (5.7 / totalBits * 100).toFixed(1);
            const grade = efficiency >= 95 ? 'A+ üåü' :
                         efficiency >= 85 ? 'A üëè' :
                         efficiency >= 75 ? 'B+ üëç' :
                         efficiency >= 65 ? 'B üòä' : 
                         efficiency >= 55 ? 'C+ üí™' : 'C üìö';
            
            document.getElementById('output').innerHTML += `
                <div style="margin: 30px 0; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; text-align: center;">
                    <h2 style="color: white; border: none; margin-bottom: 20px;">üéä Card Revealed! üéä</h2>
                    <div style="font-size: 5em; margin: 20px 0; text-shadow: 0 5px 15px rgba(0,0,0,0.3);">
                        ${secretCard.rank}${secretCard.suit}
                    </div>
                    <div style="font-size: 1.3em; margin-top: 30px; background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px;">
                        <strong>Your Performance:</strong><br><br>
                        Questions asked: <strong>${questionCount}</strong><br>
                        Total information gathered: <strong>${totalBits.toFixed(2)} bits</strong><br>
                        Theoretical minimum: <strong>5.70 bits</strong><br>
                        Efficiency: <strong>${efficiency}%</strong><br>
                        Grade: <strong style="font-size: 1.5em;">${grade}</strong>
                    </div>
                </div>
            `;
            
            updateStats();
        }
    </script>
</body>
</html>

